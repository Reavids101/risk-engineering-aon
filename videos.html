<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>Risk Engineering Videos</title>
    <style>
        /* Add your custom styles here */
    </style>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <section class="navbar">
        <img src="/risk-engineering-aon/AON.svg">
        <h1>Risk Engineering Videos</h1>
        <a href="index.html">Home</a>
        <a href="articles.html">Articles</a>
        <a href="videos.html">Videos</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <input type="text" id="searchBox" onkeyup="filterVideos()" placeholder="Search for items...">
        <div id="player"></div>
        <div id="video-feed"></div>
        <script src="https://apis.google.com/js/api.js"></script>
        <script>
            var player;
var videoFeedElement = document.getElementById('video-feed');

// Get a list of all video files in the same directory as this webpage
fetch('./', { mode: 'cors' })
    .then(response => response.text())
    .then(data => {
        var parser = new DOMParser();
        var html = parser.parseFromString(data, 'text/html');
        var videos = Array.from(html.getElementsByTagName('a'))
            .filter(link => /\.(mp4|avi|mov|MP4)$/.test(link.href))
            .map(link => {
                return {
                    id: link.href.split('/').pop().split('.')[0],
                    title: link.href.split('/').pop().split('.')[0],
                    description: '',
                    thumbnail: '',
                    duration: ''
                };
            });
        
        var videosList = [];
        var promises = videos.map(function(video) {
            var videoElement = document.createElement('video');
            videoElement.setAttribute('src', video.id + '.mp4');
            videoElement.setAttribute('type', 'video/mp4');
            videoElement.setAttribute('controls', '');

            var titleElement = document.createElement('h2');
            titleElement.textContent = video.title;

            var descriptionElement = document.createElement('p');
            descriptionElement.textContent = video.description;

            var thumbnailElement = document.createElement('img');
            thumbnailElement.setAttribute('src', video.thumbnail);

            var durationElement = document.createElement('p');
            durationElement.textContent = formatDuration(video.duration);

            var videoContainerElement = document.createElement('div');
            videoContainerElement.appendChild(titleElement);
            videoContainerElement.appendChild(descriptionElement);
            videoContainerElement.appendChild(thumbnailElement);
            videoContainerElement.appendChild(durationElement);
            videoContainerElement.appendChild(videoElement);

            videoFeedElement.appendChild(videoContainerElement);

            var videoItem = {
                id: video.id,
                title: video.title,
                description: video.description,
                thumbnail: video.thumbnail,
                duration: formatDuration(video.duration)
            };

            videosList.push(videoItem);
        });
        Promise.all(promises).then(function() {
            console.log('videos:', videos);
            console.log('videosList:', videosList);
            onVideoPlayerReady(videosList);
        });
    });

function onVideoPlayerReady(videosList) {
    if (videosList && videosList.length > 0) {
        player = videoFeedElement.children[0].getElementsByTagName('video')[0];
        player.addEventListener('ended', onVideoPlayerEnded);
    } else {
        console.error('No videos found');
    }
}

function onVideoPlayerEnded(event) {
    // Play the next video
    var nextVideo = event.target.parentNode.nextElementSibling;
    if (nextVideo) {
        nextVideo.getElementsByTagName('video')[0].play();
    }
}

// Format video duration from ISO 8601 format to hh:mm:ss
function formatDuration(duration) {
    var match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);

    var hours = (parseInt(match[1]) || 0);
    var minutes = (parseInt(match[2]) || 0);
    var seconds = (parseInt(match[3]) || 0);

    var totalSeconds = (hours * 60 * 60) + (minutes * 60) + seconds;

    var formattedDuration = '';

    if (hours > 0) {
        formattedDuration += hours + ':';
    }

    if (minutes < 10) {
        formattedDuration += '0';
    }
    formattedDuration += minutes + ':';

    if (seconds < 10) {
        formattedDuration += '0';
    }
    formattedDuration += seconds;

    return formattedDuration;
}
        </script>
    </section>
</body>
<footer>
    <!-- Add your footer content here -->
</footer>